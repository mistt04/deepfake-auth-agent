<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Deepfake Auth Agent</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gray-50 text-gray-900">
  <div class="max-w-5xl mx-auto p-6">
    <header class="mb-6">
  <h1 class="block max-w-full break-words whitespace-normal text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-extrabold leading-tight tracking-tight">
    Deepfake Detection and Media Authentication Agent
  </h1>
  <p class="text-sm md:text-base text-gray-600 mt-1">
    Analyze images via ELA baseline or your EfficientNet model.
  </p>
</header>
    <section class="bg-white rounded-2xl shadow p-6 space-y-6">

  <div class="grid md:grid-cols-3 gap-6">

    <div class="md:col-span-2">
      <label class="block text-sm font-medium mb-2">Upload image</label>
      <div id="dropzone"
           class="border-2 border-dashed rounded-2xl p-6 text-center cursor-pointer transition
                  hover:border-indigo-400 hover:bg-indigo-50/40">
        <input id="file" type="file" accept="image/*" class="hidden" />
        <p class="text-sm text-gray-600">
          Drag & drop an image here, or <span class="text-indigo-600 underline">browse</span>.
        </p>
        <div id="preview" class="hidden mt-4">
          <img id="previewImg" class="rounded-xl border max-h-64 mx-auto" />
          <p id="fileName" class="text-xs text-gray-500 mt-2"></p>
        </div>
      </div>
      <p class="text-xs text-gray-500 mt-2">JPG/PNG works best. Nothing is stored.</p>
    </div>


    <div>
      <label class="block text-sm font-medium mb-2">Method</label>
      <select id="method" class="w-full border rounded-xl px-3 py-2">
        <option value="deep">deep (EfficientNet)</option>
        <option value="ela">ela (baseline)</option>
      </select>
      <button id="analyze"
              class="mt-4 w-full bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl px-4 py-2 font-medium
                     disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2">
        <svg id="spin" class="hidden animate-spin h-5 w-5" viewBox="0 0 24 24" fill="none">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
        </svg>
        <span>Analyze</span>
      </button>
    </div>
  </div>


  <div id="resultCard" class="hidden">
    <h2 class="text-lg font-semibold mb-2">Result</h2>
    <div class="rounded-2xl border p-4 bg-gray-50 space-y-3">
      <div class="flex items-center gap-3">
        <span id="verdictBadge"
              class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold"></span>
        <span class="text-sm text-gray-600">method: <span id="methodUsed" class="font-mono"></span></span>
      </div>

      <div>
        <div class="flex justify-between text-sm mb-1">
          <span>Authenticity score</span>
          <span id="authNum" class="font-mono"></span>
        </div>
        <div class="w-full h-2 bg-white border rounded-full overflow-hidden">
          <div id="authBar" class="h-2 rounded-full"></div>
        </div>
      </div>

      <p class="text-sm text-gray-600">Suspicion score: <span id="suspNum" class="font-mono"></span></p>

      <details class="mt-2">
        <summary class="text-sm text-indigo-600 cursor-pointer">Show raw JSON</summary>
        <pre id="json" class="mt-2 text-xs overflow-x-auto"></pre>
      </details>
    </div>
  </div>


  <div id="historyWrap" class="hidden">
    <h3 class="text-sm font-semibold">Recent analyses</h3>
    <div id="history" class="mt-2 grid grid-cols-2 sm:grid-cols-4 gap-3"></div>
  </div>


  <div id="status" class="text-sm text-gray-600" aria-live="polite"></div>
</section>


    <footer class="mt-8 text-center text-xs text-gray-500">
      Built with FastAPI + PyTorch. 
    </footer>
  </div>

  <script>
  const API_BASE = location.origin;
  const $ = (id) => document.getElementById(id);

  const fileEl = $("file");
  const dz = $("dropzone");
  const methodEl = $("method");
  const btn = $("analyze");
  const spin = $("spin");

  const preview = $("preview");
  const previewImg = $("previewImg");
  const fileName = $("fileName");

  const resultCard = $("resultCard");
  const verdictBadge = $("verdictBadge");
  const methodUsed = $("methodUsed");
  const authBar = $("authBar");
  const authNum = $("authNum");
  const suspNum = $("suspNum");
  const jsonEl = $("json");
  const statusEl = $("status");
  const historyWrap = $("historyWrap");
  const historyEl = $("history");

  let history = [];

  function setLoading(v) {
    btn.disabled = v;
    spin.classList.toggle("hidden", !v);
    statusEl.textContent = v ? "Analyzing…" : "";
  }

  function setFile(f) {
    if (!f) return;
    const url = URL.createObjectURL(f);
    previewImg.src = url;
    fileName.textContent = f.name + ` • ${Math.round(f.size/1024)} KB`;
    preview.classList.remove("hidden");
  }

  dz.addEventListener("click", () => fileEl.click());
  dz.addEventListener("dragover", (e) => { e.preventDefault(); dz.classList.add("border-indigo-500"); });
  dz.addEventListener("dragleave", () => dz.classList.remove("border-indigo-500"));
  dz.addEventListener("drop", (e) => {
    e.preventDefault();
    dz.classList.remove("border-indigo-500");
    const f = e.dataTransfer.files?.[0];
    if (f) { fileEl.files = e.dataTransfer.files; setFile(f); }
  });
  fileEl.addEventListener("change", () => setFile(fileEl.files?.[0]));

  function verdict(score) {
    if (score >= 0.85) return {label:"Likely authentic", cls:"bg-green-100 text-green-700", bar:"bg-green-500"};
    if (score >= 0.6)  return {label:"Uncertain",        cls:"bg-amber-100 text-amber-700", bar:"bg-amber-500"};
    return {label:"Likely fake", cls:"bg-red-100 text-red-700", bar:"bg-red-500"};
  }

  function addToHistory(imgUrl, verdictLabel) {
    history.unshift({imgUrl, verdictLabel});
    history = history.slice(0, 6);
    historyWrap.classList.remove("hidden");
    historyEl.innerHTML = history.map(h =>
      `<div class="rounded-xl overflow-hidden border bg-white">
         <img src="${h.imgUrl}" class="w-full h-24 object-cover"/>
         <div class="p-2 text-center text-xs">${h.verdictLabel}</div>
       </div>`).join("");
  }

  btn.addEventListener("click", async () => {
    const f = fileEl.files?.[0];
    const method = methodEl.value;
    if (!f) { statusEl.textContent = "Please choose an image."; return; }

    setLoading(true);
    resultCard.classList.add("hidden");

    const fd = new FormData();
    fd.append("file", f);

    try {
      const r = await fetch(`${API_BASE}/analyze/image?method=${encodeURIComponent(method)}`, {
        method: "POST",
        body: fd
      });
      if (!r.ok) throw new Error(`HTTP ${r.status}`);
      const data = await r.json();

      const auth = Number(data.authenticity_score ?? data.authenticity ?? 0);
      const susp = Number(data.suspicion_score ?? data.suspicion ?? 0);
      const v = verdict(auth);

      verdictBadge.textContent = v.label;
      verdictBadge.className = `inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold ${v.cls}`;
      methodUsed.textContent = data.method || method;

      authNum.textContent = auth.toFixed(3);
      suspNum.textContent = susp.toFixed(3);
      authBar.style.width = Math.round(auth * 100) + "%";
      authBar.className = `h-2 rounded-full ${v.bar}`;

      jsonEl.textContent = JSON.stringify(data, null, 2);
      resultCard.classList.remove("hidden");
      statusEl.textContent = "Done.";

      addToHistory(previewImg.src, v.label);
    } catch (e) {
      statusEl.textContent = "Error: " + e.message;
    } finally {
      setLoading(false);
    }
  });

  // Submit on Enter
  document.addEventListener("keydown", (e) => {
    if (e.key === "Enter") btn.click();
  });
</script>

  
</body>
</html>
